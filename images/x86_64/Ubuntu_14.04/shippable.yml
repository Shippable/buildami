resources:
  - name: u14microbase_dd_repo
    type: gitRepo
    integration: avinci_gh
    versionTemplate:
      sourceName: "dry-dock/u14microbase"
      branch: master

  - name: u14microbase_dd_img
    type: image
    integration: shipDH
    versionTemplate:
      sourceName: "drydock/u14microbase"
      versionName: master

  - name: baseami_params
    type: params
    version:
      params:
        SOURCE_AMI: "ami-772aa961"
        VPC_ID: "vpc-266f3241"
        SUBNET_ID: "subnet-6df12f24"
        SECURITY_GROUP_ID: "sg-f634518c"
        REGION: "us-east-1"

  - name: u14_dd_repo
    type: gitRepo
    integration: avinci_gh
    pointer:
      sourceName: dry-dock/u14
      branch: master

  - name: u14_dd_img
    type: image
    integration: shipDH
    pointer:
      sourceName: "drydock/u14"
    seed:
      versionName: master

  - name: u14all_dd_repo
    type: gitRepo
    integration: avinci_gh
    pointer:
      sourceName: dry-dock/u14all
      branch: master

  - name: u14all_dd_img
    type: image
    integration: shipDH
    pointer:
      sourceName: "drydock/u14all"
    seed:
      versionName: master

  - name: u14nodall_dd_repo
    type: gitRepo
    integration: avinci_gh
    pointer:
      sourceName: dry-dock/u14nodall
      branch: master

  - name: u14nodall_dd_img
    type: image
    integration: shipDH
    pointer:
      sourceName: "drydock/u14nodall"
    seed:
      versionName: master

  - name: u14pytall_dd_repo
    type: gitRepo
    integration: avinci_gh
    pointer:
      sourceName: dry-dock/u14pytall
      branch: master

  - name: u14pytall_dd_img
    type: image
    integration: shipDH
    pointer:
      sourceName: "drydock/u14pytall"
    seed:
      versionName: master

  - name: u14javall_dd_repo
    type: gitRepo
    integration: avinci_gh
    pointer:
      sourceName: dry-dock/u14javall
      branch: master

  - name: u14javall_dd_img
    type: image
    integration: shipDH
    pointer:
      sourceName: "drydock/u14javall"
    seed:
      versionName: master

  - name: u14cppall_dd_repo
    type: gitRepo
    integration: avinci_gh
    pointer:
      sourceName: dry-dock/u14cppall
      branch: master

  - name: u14cppall_dd_img
    type: image
    integration: shipDH
    pointer:
      sourceName: "drydock/u14cppall"
    seed:
      versionName: master

  - name: u14ruball_dd_repo
    type: gitRepo
    integration: avinci_gh
    pointer:
      sourceName: dry-dock/u14ruball
      branch: master

  - name: u14ruball_dd_img
    type: image
    integration: shipDH
    pointer:
      sourceName: "drydock/u14ruball"
    seed:
      versionName: master

  - name: u14phpall_dd_repo
    type: gitRepo
    integration: avinci_gh
    pointer:
      sourceName: dry-dock/u14phpall
      branch: master

  - name: u14phpall_dd_img
    type: image
    integration: shipDH
    pointer:
      sourceName: "drydock/u14phpall"
    seed:
      versionName: master

  - name: u14scaall_dd_repo
    type: gitRepo
    integration: avinci_gh
    pointer:
      sourceName: dry-dock/u14scaall
      branch: master

  - name: u14scaall_dd_img
    type: image
    integration: shipDH
    pointer:
      sourceName: "drydock/u14scaall"
    seed:
      versionName: master

  - name: u14cloall_dd_repo
    type: gitRepo
    integration: avinci_gh
    pointer:
      sourceName: dry-dock/u14cloall
      branch: master

  - name: u14cloall_dd_img
    type: image
    integration: shipDH
    pointer:
      sourceName: "drydock/u14cloall"
    seed:
      versionName: master

  - name: u14golall_dd_repo
    type: gitRepo
    integration: avinci_gh
    pointer:
      sourceName: dry-dock/u14golall
      branch: master

  - name: u14golall_dd_img
    type: image
    integration: shipDH
    pointer:
      sourceName: "drydock/u14golall"
    seed:
      versionName: master

jobs:
  - name: u14microbase_x8664_build
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    runtime:
      nodePool: x86_u1404_dyn_large_01
    steps:
      - IN: u14microbase_dd_repo
      - IN: u14_dd_img
      - TASK:
          name: u14microbase_build
          runtime:
            options:
              env:
                - IMG_BASE: "u14_dd_img"
                - IMG_OUT: "u14microbase_dd_img"
                - RES_REPO: "u14microbase_dd_repo"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$IMG_BASE" "versionName")
            - REPO_COMMIT=$(shipctl get_resource_version_key "$RES_REPO" "shaData.commitSha")
            - IMG_NAME=$(shipctl get_resource_version_key $IMG_OUT "sourceName")
            - DH_USR_NAME=$(shipctl get_integration_resource_field $IMG_OUT "userName")
            - DH_PASS=$(shipctl get_integration_resource_field $IMG_OUT "password")
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - docker build -t=$IMG_NAME:$REL_VER --pull .
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker push $IMG_NAME:$REL_VER
      - OUT: u14microbase_dd_img
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT"
        - shipctl put_resource_state_multi $IMG_OUT "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT" "BUILD_NUMBER=$BUILD_NUMBER"

  - name: u14microbase_x8664_tag
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prod_release
      - IN: u14microbase_dd_repo
        switch: off
      - IN: u14microbase_dd_img
        switch: off
      - IN: shipit_gh_ssh
        switch: off
      - TASK:
          name: u14microbase_tag
          runtime:
            options:
              env:
                - RES_VER: "prod_release"
                - RES_IMG: "u14microbase_dd_img"
                - RES_REPO: "u14microbase_dd_repo"
                - GIT_PATH: "git@github.com:dry-dock/u14microbase.git"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$RES_VER" "versionName")
            - |
               REPO_COMMIT=$(shipctl get_resource_version_key "$RES_IMG" "IMG_REPO_COMMIT_SHA")
               IMG_NAME=$(shipctl get_resource_version_key "$RES_IMG" "sourceName")
               UP_IMG_TAG=$(shipctl get_resource_version_key "$RES_IMG" "versionName")
               DH_USR_NAME=$(shipctl get_integration_resource_field "$RES_IMG" "userName")
               DH_PASS=$(shipctl get_integration_resource_field "$RES_IMG" "password")
            - |
               pushd $(shipctl get_resource_meta "shipit_gh_ssh")
                 shipctl get_json_value integration.json 'privateKey' > gh_ssh.key
                 chmod 600 gh_ssh.key
                 ssh-add gh_ssh.key
               popd
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker pull "$IMG_NAME:$UP_IMG_TAG"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:$REL_VER"
               docker push "$IMG_NAME:$REL_VER"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:latest"
               docker push "$IMG_NAME:latest"
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - |
               git remote add up $GIT_PATH
               git remote -v
               git checkout master
            - |
               git pull --tags
               if git tag -d $REL_VER; then
                 git push --delete up $REL_VER
               fi
            - |
               git checkout $REPO_COMMIT
               git tag $REL_VER
               git push up $REL_VER
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "TAG_COMMIT_SHA=$REPO_COMMIT" "TAG_IMG=$REL_VER"

  - name: u14_x8664_build
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    runtime:
      nodePool: x86_u1404_dyn_large_01
    steps:
      - IN: u14_dd_repo
      - TASK:
          name: u14_build
          runtime:
            options:
              env:
                - REL_VER: "master"
                - IMG_OUT: "u14_dd_img"
                - RES_REPO: "u14_dd_repo"
          script:
            - REPO_COMMIT=$(shipctl get_resource_version_key "$RES_REPO" "shaData.commitSha")
            - IMG_NAME=$(shipctl get_resource_version_key $IMG_OUT "sourceName")
            - DH_USR_NAME=$(shipctl get_integration_resource_field $IMG_OUT "userName")
            - DH_PASS=$(shipctl get_integration_resource_field $IMG_OUT "password")
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - docker build -t=$IMG_NAME:$REL_VER --pull .
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker push $IMG_NAME:$REL_VER
      - OUT: u14_dd_img
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT"
        - shipctl put_resource_state_multi $IMG_OUT "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT" "BUILD_NUMBER=$BUILD_NUMBER"

  - name: u14all_x8664_build
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    runtime:
      nodePool: x86_u1404_dyn_large_01
    steps:
      - IN: u14all_dd_repo
      - IN: u14_dd_img
      - TASK:
          name: u14all_build
          runtime:
            options:
              env:
                - IMG_BASE: "u14_dd_img"
                - IMG_OUT: "u14all_dd_img"
                - RES_REPO: "u14all_dd_repo"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$IMG_BASE" "versionName")
            - REPO_COMMIT=$(shipctl get_resource_version_key "$RES_REPO" "shaData.commitSha")
            - IMG_NAME=$(shipctl get_resource_version_key $IMG_OUT "sourceName")
            - DH_USR_NAME=$(shipctl get_integration_resource_field $IMG_OUT "userName")
            - DH_PASS=$(shipctl get_integration_resource_field $IMG_OUT "password")
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - docker build -t=$IMG_NAME:$REL_VER --pull .
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker push $IMG_NAME:$REL_VER
      - OUT: u14all_dd_img
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT"
        - shipctl put_resource_state_multi $IMG_OUT "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT" "BUILD_NUMBER=$BUILD_NUMBER"

  - name: u14nodall_x8664_build
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    runtime:
      nodePool: x86_u1404_dyn_large_01
    steps:
      - IN: u14nodall_dd_repo
      - IN: u14all_dd_img
      - TASK:
          name: u14nodall_build
          runtime:
            options:
              env:
                - IMG_BASE: "u14all_dd_img"
                - IMG_OUT: "u14nodall_dd_img"
                - RES_REPO: "u14nodall_dd_repo"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$IMG_BASE" "versionName")
            - REPO_COMMIT=$(shipctl get_resource_version_key "$RES_REPO" "shaData.commitSha")
            - IMG_NAME=$(shipctl get_resource_version_key $IMG_OUT "sourceName")
            - DH_USR_NAME=$(shipctl get_integration_resource_field $IMG_OUT "userName")
            - DH_PASS=$(shipctl get_integration_resource_field $IMG_OUT "password")
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - docker build -t=$IMG_NAME:$REL_VER --pull .
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker push $IMG_NAME:$REL_VER
      - OUT: u14nodall_dd_img
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT"
        - shipctl put_resource_state_multi $IMG_OUT "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT" "BUILD_NUMBER=$BUILD_NUMBER"

  - name: u14pytall_x8664_build
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    runtime:
      nodePool: x86_u1404_dyn_large_01
    steps:
      - IN: u14pytall_dd_repo
      - IN: u14all_dd_img
      - TASK:
          name: u14pytall_build
          runtime:
            options:
              env:
                - IMG_BASE: "u14all_dd_img"
                - IMG_OUT: "u14pytall_dd_img"
                - RES_REPO: "u14pytall_dd_repo"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$IMG_BASE" "versionName")
            - REPO_COMMIT=$(shipctl get_resource_version_key "$RES_REPO" "shaData.commitSha")
            - IMG_NAME=$(shipctl get_resource_version_key $IMG_OUT "sourceName")
            - DH_USR_NAME=$(shipctl get_integration_resource_field $IMG_OUT "userName")
            - DH_PASS=$(shipctl get_integration_resource_field $IMG_OUT "password")
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - docker build -t=$IMG_NAME:$REL_VER --pull .
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker push $IMG_NAME:$REL_VER
      - OUT: u14pytall_dd_img
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT"
        - shipctl put_resource_state_multi $IMG_OUT "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT" "BUILD_NUMBER=$BUILD_NUMBER"

  - name: u14javall_x8664_build
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    runtime:
      nodePool: x86_u1404_dyn_large_01
    steps:
      - IN: u14javall_dd_repo
      - IN: u14all_dd_img
      - TASK:
          name: u14pytall_build
          runtime:
            options:
              env:
                - IMG_BASE: "u14all_dd_img"
                - IMG_OUT: "u14javall_dd_img"
                - RES_REPO: "u14javall_dd_repo"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$IMG_BASE" "versionName")
            - REPO_COMMIT=$(shipctl get_resource_version_key "$RES_REPO" "shaData.commitSha")
            - IMG_NAME=$(shipctl get_resource_version_key $IMG_OUT "sourceName")
            - DH_USR_NAME=$(shipctl get_integration_resource_field $IMG_OUT "userName")
            - DH_PASS=$(shipctl get_integration_resource_field $IMG_OUT "password")
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - docker build -t=$IMG_NAME:$REL_VER --pull .
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker push $IMG_NAME:$REL_VER
      - OUT: u14javall_dd_img
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT"
        - shipctl put_resource_state_multi $IMG_OUT "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT" "BUILD_NUMBER=$BUILD_NUMBER"

  - name: u14cppall_x8664_build
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    runtime:
      nodePool: x86_u1404_dyn_large_01
    steps:
      - IN: u14cppall_dd_repo
      - IN: u14all_dd_img
      - TASK:
          name: u14cppall_build
          runtime:
            options:
              env:
                - IMG_BASE: "u14all_dd_img"
                - IMG_OUT: "u14cppall_dd_img"
                - RES_REPO: "u14cppall_dd_repo"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$IMG_BASE" "versionName")
            - REPO_COMMIT=$(shipctl get_resource_version_key "$RES_REPO" "shaData.commitSha")
            - IMG_NAME=$(shipctl get_resource_version_key $IMG_OUT "sourceName")
            - DH_USR_NAME=$(shipctl get_integration_resource_field $IMG_OUT "userName")
            - DH_PASS=$(shipctl get_integration_resource_field $IMG_OUT "password")
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - docker build -t=$IMG_NAME:$REL_VER --pull .
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker push $IMG_NAME:$REL_VER
      - OUT: u14cppall_dd_img
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT"
        - shipctl put_resource_state_multi $IMG_OUT "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT" "BUILD_NUMBER=$BUILD_NUMBER"

  - name: u14golall_x8664_build
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    runtime:
      nodePool: x86_u1404_dyn_large_01
    steps:
      - IN: u14golall_dd_repo
      - IN: u14all_dd_img
      - TASK:
          name: u14golall_build
          runtime:
            options:
              env:
                - IMG_BASE: "u14all_dd_img"
                - IMG_OUT: "u14golall_dd_img"
                - RES_REPO: "u14golall_dd_repo"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$IMG_BASE" "versionName")
            - REPO_COMMIT=$(shipctl get_resource_version_key "$RES_REPO" "shaData.commitSha")
            - IMG_NAME=$(shipctl get_resource_version_key $IMG_OUT "sourceName")
            - DH_USR_NAME=$(shipctl get_integration_resource_field $IMG_OUT "userName")
            - DH_PASS=$(shipctl get_integration_resource_field $IMG_OUT "password")
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - docker build -t=$IMG_NAME:$REL_VER --pull .
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker push $IMG_NAME:$REL_VER
      - OUT: u14golall_dd_img
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT"
        - shipctl put_resource_state_multi $IMG_OUT "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT" "BUILD_NUMBER=$BUILD_NUMBER"

  - name: u14phpall_x8664_build
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    runtime:
      nodePool: x86_u1404_dyn_large_01
    steps:
      - IN: u14phpall_dd_repo
      - IN: u14all_dd_img
      - TASK:
          name: u14phpall_build
          runtime:
            options:
              env:
                - IMG_BASE: "u14all_dd_img"
                - IMG_OUT: "u14phpall_dd_img"
                - RES_REPO: "u14phpall_dd_repo"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$IMG_BASE" "versionName")
            - REPO_COMMIT=$(shipctl get_resource_version_key "$RES_REPO" "shaData.commitSha")
            - IMG_NAME=$(shipctl get_resource_version_key $IMG_OUT "sourceName")
            - DH_USR_NAME=$(shipctl get_integration_resource_field $IMG_OUT "userName")
            - DH_PASS=$(shipctl get_integration_resource_field $IMG_OUT "password")
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - docker build -t=$IMG_NAME:$REL_VER --pull .
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker push $IMG_NAME:$REL_VER
      - OUT: u14phpall_dd_img
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT"
        - shipctl put_resource_state_multi $IMG_OUT "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT" "BUILD_NUMBER=$BUILD_NUMBER"

  - name: u14cloall_x8664_build
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    runtime:
      nodePool: x86_u1404_dyn_large_01
    steps:
      - IN: u14cloall_dd_repo
      - IN: u14all_dd_img
      - TASK:
          name: u14cloall_build
          runtime:
            options:
              env:
                - IMG_BASE: "u14all_dd_img"
                - IMG_OUT: "u14cloall_dd_img"
                - RES_REPO: "u14cloall_dd_repo"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$IMG_BASE" "versionName")
            - REPO_COMMIT=$(shipctl get_resource_version_key "$RES_REPO" "shaData.commitSha")
            - IMG_NAME=$(shipctl get_resource_version_key $IMG_OUT "sourceName")
            - DH_USR_NAME=$(shipctl get_integration_resource_field $IMG_OUT "userName")
            - DH_PASS=$(shipctl get_integration_resource_field $IMG_OUT "password")
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - docker build -t=$IMG_NAME:$REL_VER --pull .
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker push $IMG_NAME:$REL_VER
      - OUT: u14cloall_dd_img
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT"
        - shipctl put_resource_state_multi $IMG_OUT "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT" "BUILD_NUMBER=$BUILD_NUMBER"

  - name: u14ruball_x8664_build
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    runtime:
      nodePool: x86_u1404_dyn_large_01
    steps:
      - IN: u14ruball_dd_repo
      - IN: u14all_dd_img
      - TASK:
          name: u14ruball_build
          runtime:
            options:
              env:
                - IMG_BASE: "u14all_dd_img"
                - IMG_OUT: "u14ruball_dd_img"
                - RES_REPO: "u14ruball_dd_repo"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$IMG_BASE" "versionName")
            - REPO_COMMIT=$(shipctl get_resource_version_key "$RES_REPO" "shaData.commitSha")
            - IMG_NAME=$(shipctl get_resource_version_key $IMG_OUT "sourceName")
            - DH_USR_NAME=$(shipctl get_integration_resource_field $IMG_OUT "userName")
            - DH_PASS=$(shipctl get_integration_resource_field $IMG_OUT "password")
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - docker build -t=$IMG_NAME:$REL_VER --pull .
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker push $IMG_NAME:$REL_VER
      - OUT: u14ruball_dd_img
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT"
        - shipctl put_resource_state_multi $IMG_OUT "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT" "BUILD_NUMBER=$BUILD_NUMBER"

  - name: u14scaall_x8664_build
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    runtime:
      nodePool: x86_u1404_dyn_large_01
    steps:
      - IN: u14scaall_dd_repo
      - IN: u14javall_dd_img
      - TASK:
          name: u14scaall_build
          runtime:
            options:
              env:
                - IMG_BASE: "u14javall_dd_img"
                - IMG_OUT: "u14scaall_dd_img"
                - RES_REPO: "u14scaall_dd_repo"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$IMG_BASE" "versionName")
            - REPO_COMMIT=$(shipctl get_resource_version_key "$RES_REPO" "shaData.commitSha")
            - IMG_NAME=$(shipctl get_resource_version_key $IMG_OUT "sourceName")
            - DH_USR_NAME=$(shipctl get_integration_resource_field $IMG_OUT "userName")
            - DH_PASS=$(shipctl get_integration_resource_field $IMG_OUT "password")
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - docker build -t=$IMG_NAME:$REL_VER --pull .
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker push $IMG_NAME:$REL_VER
      - OUT: u14scaall_dd_img
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT"
        - shipctl put_resource_state_multi $IMG_OUT "versionName=$REL_VER" "IMG_REPO_COMMIT_SHA=$REPO_COMMIT" "BUILD_NUMBER=$BUILD_NUMBER"

######

  - name: u14_x8664_tag
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prod_release
      - IN: u14_dd_repo
        switch: off
      - IN: u14_dd_img
        switch: off
      - IN: shipit_gh_ssh
        switch: off
      - TASK:
          name: u14_tag
          runtime:
            options:
              env:
                - RES_VER: "prod_release"
                - RES_IMG: "u14_dd_img"
                - RES_REPO: "u14_dd_repo"
                - GIT_PATH: "git@github.com:dry-dock/u14.git"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$RES_VER" "versionName")
            - |
               REPO_COMMIT=$(shipctl get_resource_version_key "$RES_IMG" "IMG_REPO_COMMIT_SHA")
               IMG_NAME=$(shipctl get_resource_version_key "$RES_IMG" "sourceName")
               UP_IMG_TAG=$(shipctl get_resource_version_key "$RES_IMG" "versionName")
               DH_USR_NAME=$(shipctl get_integration_resource_field "$RES_IMG" "userName")
               DH_PASS=$(shipctl get_integration_resource_field "$RES_IMG" "password")
            - |
               pushd $(shipctl get_resource_meta "shipit_gh_ssh")
                 shipctl get_json_value integration.json 'privateKey' > gh_ssh.key
                 chmod 600 gh_ssh.key
                 ssh-add gh_ssh.key
               popd
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker pull "$IMG_NAME:$UP_IMG_TAG"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:$REL_VER"
               docker push "$IMG_NAME:$REL_VER"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:latest"
               docker push "$IMG_NAME:latest"
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - |
               git remote add up $GIT_PATH
               git remote -v
               git checkout master
            - |
               git pull --tags
               if git tag -d $REL_VER; then
                 git push --delete up $REL_VER
               fi
            - |
               git checkout $REPO_COMMIT
               git tag $REL_VER
               git push up $REL_VER
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "TAG_COMMIT_SHA=$REPO_COMMIT" "TAG_IMG=$REL_VER"

  - name: u14all_x8664_tag
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prod_release
      - IN: u14all_dd_repo
        switch: off
      - IN: u14all_dd_img
        switch: off
      - IN: shipit_gh_ssh
        switch: off
      - TASK:
          name: u14all_tag
          runtime:
            options:
              env:
                - RES_VER: "prod_release"
                - RES_IMG: "u14all_dd_img"
                - RES_REPO: "u14all_dd_repo"
                - GIT_PATH: "git@github.com:dry-dock/u14all.git"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$RES_VER" "versionName")
            - |
               REPO_COMMIT=$(shipctl get_resource_version_key "$RES_IMG" "IMG_REPO_COMMIT_SHA")
               IMG_NAME=$(shipctl get_resource_version_key "$RES_IMG" "sourceName")
               UP_IMG_TAG=$(shipctl get_resource_version_key "$RES_IMG" "versionName")
               DH_USR_NAME=$(shipctl get_integration_resource_field "$RES_IMG" "userName")
               DH_PASS=$(shipctl get_integration_resource_field "$RES_IMG" "password")
            - |
               pushd $(shipctl get_resource_meta "shipit_gh_ssh")
                 shipctl get_json_value integration.json 'privateKey' > gh_ssh.key
                 chmod 600 gh_ssh.key
                 ssh-add gh_ssh.key
               popd
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker pull "$IMG_NAME:$UP_IMG_TAG"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:$REL_VER"
               docker push "$IMG_NAME:$REL_VER"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:latest"
               docker push "$IMG_NAME:latest"
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - |
               git remote add up $GIT_PATH
               git remote -v
               git checkout master
            - |
               git pull --tags
               if git tag -d $REL_VER; then
                 git push --delete up $REL_VER
               fi
            - |
               git checkout $REPO_COMMIT
               git tag $REL_VER
               git push up $REL_VER
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "TAG_COMMIT_SHA=$REPO_COMMIT" "TAG_IMG=$REL_VER"

  - name: u14nodall_x8664_tag
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prod_release
      - IN: u14nodall_dd_repo
        switch: off
      - IN: u14nodall_dd_img
        switch: off
      - IN: shipit_gh_ssh
        switch: off
      - TASK:
          name: u14nodall_tag
          runtime:
            options:
              env:
                - RES_VER: "prod_release"
                - RES_IMG: "u14nodall_dd_img"
                - RES_REPO: "u14nodall_dd_repo"
                - GIT_PATH: "git@github.com:dry-dock/u14nodall.git"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$RES_VER" "versionName")
            - |
               REPO_COMMIT=$(shipctl get_resource_version_key "$RES_IMG" "IMG_REPO_COMMIT_SHA")
               IMG_NAME=$(shipctl get_resource_version_key "$RES_IMG" "sourceName")
               UP_IMG_TAG=$(shipctl get_resource_version_key "$RES_IMG" "versionName")
               DH_USR_NAME=$(shipctl get_integration_resource_field "$RES_IMG" "userName")
               DH_PASS=$(shipctl get_integration_resource_field "$RES_IMG" "password")
            - |
               pushd $(shipctl get_resource_meta "shipit_gh_ssh")
                 shipctl get_json_value integration.json 'privateKey' > gh_ssh.key
                 chmod 600 gh_ssh.key
                 ssh-add gh_ssh.key
               popd
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker pull "$IMG_NAME:$UP_IMG_TAG"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:$REL_VER"
               docker push "$IMG_NAME:$REL_VER"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:latest"
               docker push "$IMG_NAME:latest"
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - |
               git remote add up $GIT_PATH
               git remote -v
               git checkout master
            - |
               git pull --tags
               if git tag -d $REL_VER; then
                 git push --delete up $REL_VER
               fi
            - |
               git checkout $REPO_COMMIT
               git tag $REL_VER
               git push up $REL_VER
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "TAG_COMMIT_SHA=$REPO_COMMIT" "TAG_IMG=$REL_VER"

  - name: u14pytall_x8664_tag
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prod_release
      - IN: u14pytall_dd_repo
        switch: off
      - IN: u14pytall_dd_img
        switch: off
      - IN: shipit_gh_ssh
        switch: off
      - TASK:
          name: u14pytall_tag
          runtime:
            options:
              env:
                - RES_VER: "prod_release"
                - RES_IMG: "u14pytall_dd_img"
                - RES_REPO: "u14pytall_dd_repo"
                - GIT_PATH: "git@github.com:dry-dock/u14pytall.git"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$RES_VER" "versionName")
            - |
               REPO_COMMIT=$(shipctl get_resource_version_key "$RES_IMG" "IMG_REPO_COMMIT_SHA")
               IMG_NAME=$(shipctl get_resource_version_key "$RES_IMG" "sourceName")
               UP_IMG_TAG=$(shipctl get_resource_version_key "$RES_IMG" "versionName")
               DH_USR_NAME=$(shipctl get_integration_resource_field "$RES_IMG" "userName")
               DH_PASS=$(shipctl get_integration_resource_field "$RES_IMG" "password")
            - |
               pushd $(shipctl get_resource_meta "shipit_gh_ssh")
                 shipctl get_json_value integration.json 'privateKey' > gh_ssh.key
                 chmod 600 gh_ssh.key
                 ssh-add gh_ssh.key
               popd
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker pull "$IMG_NAME:$UP_IMG_TAG"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:$REL_VER"
               docker push "$IMG_NAME:$REL_VER"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:latest"
               docker push "$IMG_NAME:latest"
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - |
               git remote add up $GIT_PATH
               git remote -v
               git checkout master
            - |
               git pull --tags
               if git tag -d $REL_VER; then
                 git push --delete up $REL_VER
               fi
            - |
               git checkout $REPO_COMMIT
               git tag $REL_VER
               git push up $REL_VER
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "TAG_COMMIT_SHA=$REPO_COMMIT" "TAG_IMG=$REL_VER"

  - name: u14javall_x8664_tag
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prod_release
      - IN: u14javall_dd_repo
        switch: off
      - IN: u14javall_dd_img
        switch: off
      - IN: shipit_gh_ssh
        switch: off
      - TASK:
          name: u14javall_tag
          runtime:
            options:
              env:
                - RES_VER: "prod_release"
                - RES_IMG: "u14javall_dd_img"
                - RES_REPO: "u14javall_dd_repo"
                - GIT_PATH: "git@github.com:dry-dock/u14javall.git"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$RES_VER" "versionName")
            - |
               REPO_COMMIT=$(shipctl get_resource_version_key "$RES_IMG" "IMG_REPO_COMMIT_SHA")
               IMG_NAME=$(shipctl get_resource_version_key "$RES_IMG" "sourceName")
               UP_IMG_TAG=$(shipctl get_resource_version_key "$RES_IMG" "versionName")
               DH_USR_NAME=$(shipctl get_integration_resource_field "$RES_IMG" "userName")
               DH_PASS=$(shipctl get_integration_resource_field "$RES_IMG" "password")
            - |
               pushd $(shipctl get_resource_meta "shipit_gh_ssh")
                 shipctl get_json_value integration.json 'privateKey' > gh_ssh.key
                 chmod 600 gh_ssh.key
                 ssh-add gh_ssh.key
               popd
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker pull "$IMG_NAME:$UP_IMG_TAG"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:$REL_VER"
               docker push "$IMG_NAME:$REL_VER"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:latest"
               docker push "$IMG_NAME:latest"
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - |
               git remote add up $GIT_PATH
               git remote -v
               git checkout master
            - |
               git pull --tags
               if git tag -d $REL_VER; then
                 git push --delete up $REL_VER
               fi
            - |
               git checkout $REPO_COMMIT
               git tag $REL_VER
               git push up $REL_VER
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "TAG_COMMIT_SHA=$REPO_COMMIT" "TAG_IMG=$REL_VER"

  - name: u14cppall_x8664_tag
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prod_release
      - IN: u14cppall_dd_repo
        switch: off
      - IN: u14cppall_dd_img
        switch: off
      - IN: shipit_gh_ssh
        switch: off
      - TASK:
          name: u14cppall_tag
          runtime:
            options:
              env:
                - RES_VER: "prod_release"
                - RES_IMG: "u14cppall_dd_img"
                - RES_REPO: "u14cppall_dd_repo"
                - GIT_PATH: "git@github.com:dry-dock/u14cppall.git"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$RES_VER" "versionName")
            - |
               REPO_COMMIT=$(shipctl get_resource_version_key "$RES_IMG" "IMG_REPO_COMMIT_SHA")
               IMG_NAME=$(shipctl get_resource_version_key "$RES_IMG" "sourceName")
               UP_IMG_TAG=$(shipctl get_resource_version_key "$RES_IMG" "versionName")
               DH_USR_NAME=$(shipctl get_integration_resource_field "$RES_IMG" "userName")
               DH_PASS=$(shipctl get_integration_resource_field "$RES_IMG" "password")
            - |
               pushd $(shipctl get_resource_meta "shipit_gh_ssh")
                 shipctl get_json_value integration.json 'privateKey' > gh_ssh.key
                 chmod 600 gh_ssh.key
                 ssh-add gh_ssh.key
               popd
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker pull "$IMG_NAME:$UP_IMG_TAG"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:$REL_VER"
               docker push "$IMG_NAME:$REL_VER"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:latest"
               docker push "$IMG_NAME:latest"
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - |
               git remote add up $GIT_PATH
               git remote -v
               git checkout master
            - |
               git pull --tags
               if git tag -d $REL_VER; then
                 git push --delete up $REL_VER
               fi
            - |
               git checkout $REPO_COMMIT
               git tag $REL_VER
               git push up $REL_VER
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "TAG_COMMIT_SHA=$REPO_COMMIT" "TAG_IMG=$REL_VER"

  - name: u14cloall_x8664_tag
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prod_release
      - IN: u14cloall_dd_repo
        switch: off
      - IN: u14cloall_dd_img
        switch: off
      - IN: shipit_gh_ssh
        switch: off
      - TASK:
          name: u14cloall_tag
          runtime:
            options:
              env:
                - RES_VER: "prod_release"
                - RES_IMG: "u14cloall_dd_img"
                - RES_REPO: "u14cloall_dd_repo"
                - GIT_PATH: "git@github.com:dry-dock/u14cloall.git"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$RES_VER" "versionName")
            - |
               REPO_COMMIT=$(shipctl get_resource_version_key "$RES_IMG" "IMG_REPO_COMMIT_SHA")
               IMG_NAME=$(shipctl get_resource_version_key "$RES_IMG" "sourceName")
               UP_IMG_TAG=$(shipctl get_resource_version_key "$RES_IMG" "versionName")
               DH_USR_NAME=$(shipctl get_integration_resource_field "$RES_IMG" "userName")
               DH_PASS=$(shipctl get_integration_resource_field "$RES_IMG" "password")
            - |
               pushd $(shipctl get_resource_meta "shipit_gh_ssh")
                 shipctl get_json_value integration.json 'privateKey' > gh_ssh.key
                 chmod 600 gh_ssh.key
                 ssh-add gh_ssh.key
               popd
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker pull "$IMG_NAME:$UP_IMG_TAG"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:$REL_VER"
               docker push "$IMG_NAME:$REL_VER"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:latest"
               docker push "$IMG_NAME:latest"
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - |
               git remote add up $GIT_PATH
               git remote -v
               git checkout master
            - |
               git pull --tags
               if git tag -d $REL_VER; then
                 git push --delete up $REL_VER
               fi
            - |
               git checkout $REPO_COMMIT
               git tag $REL_VER
               git push up $REL_VER
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "TAG_COMMIT_SHA=$REPO_COMMIT" "TAG_IMG=$REL_VER"

  - name: u14golall_x8664_tag
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prod_release
      - IN: u14golall_dd_repo
        switch: off
      - IN: u14golall_dd_img
        switch: off
      - IN: shipit_gh_ssh
        switch: off
      - TASK:
          name: u14golall_tag
          runtime:
            options:
              env:
                - RES_VER: "prod_release"
                - RES_IMG: "u14golall_dd_img"
                - RES_REPO: "u14golall_dd_repo"
                - GIT_PATH: "git@github.com:dry-dock/u14golall.git"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$RES_VER" "versionName")
            - |
               REPO_COMMIT=$(shipctl get_resource_version_key "$RES_IMG" "IMG_REPO_COMMIT_SHA")
               IMG_NAME=$(shipctl get_resource_version_key "$RES_IMG" "sourceName")
               UP_IMG_TAG=$(shipctl get_resource_version_key "$RES_IMG" "versionName")
               DH_USR_NAME=$(shipctl get_integration_resource_field "$RES_IMG" "userName")
               DH_PASS=$(shipctl get_integration_resource_field "$RES_IMG" "password")
            - |
               pushd $(shipctl get_resource_meta "shipit_gh_ssh")
                 shipctl get_json_value integration.json 'privateKey' > gh_ssh.key
                 chmod 600 gh_ssh.key
                 ssh-add gh_ssh.key
               popd
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker pull "$IMG_NAME:$UP_IMG_TAG"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:$REL_VER"
               docker push "$IMG_NAME:$REL_VER"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:latest"
               docker push "$IMG_NAME:latest"
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - |
               git remote add up $GIT_PATH
               git remote -v
               git checkout master
            - |
               git pull --tags
               if git tag -d $REL_VER; then
                 git push --delete up $REL_VER
               fi
            - |
               git checkout $REPO_COMMIT
               git tag $REL_VER
               git push up $REL_VER
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "TAG_COMMIT_SHA=$REPO_COMMIT" "TAG_IMG=$REL_VER"

  - name: u14scaall_x8664_tag
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prod_release
      - IN: u14scaall_dd_repo
        switch: off
      - IN: u14scaall_dd_img
        switch: off
      - IN: shipit_gh_ssh
        switch: off
      - TASK:
          name: u14scaall_tag
          runtime:
            options:
              env:
                - RES_VER: "prod_release"
                - RES_IMG: "u14scaall_dd_img"
                - RES_REPO: "u14scaall_dd_repo"
                - GIT_PATH: "git@github.com:dry-dock/u14scaall.git"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$RES_VER" "versionName")
            - |
               REPO_COMMIT=$(shipctl get_resource_version_key "$RES_IMG" "IMG_REPO_COMMIT_SHA")
               IMG_NAME=$(shipctl get_resource_version_key "$RES_IMG" "sourceName")
               UP_IMG_TAG=$(shipctl get_resource_version_key "$RES_IMG" "versionName")
               DH_USR_NAME=$(shipctl get_integration_resource_field "$RES_IMG" "userName")
               DH_PASS=$(shipctl get_integration_resource_field "$RES_IMG" "password")
            - |
               pushd $(shipctl get_resource_meta "shipit_gh_ssh")
                 shipctl get_json_value integration.json 'privateKey' > gh_ssh.key
                 chmod 600 gh_ssh.key
                 ssh-add gh_ssh.key
               popd
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker pull "$IMG_NAME:$UP_IMG_TAG"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:$REL_VER"
               docker push "$IMG_NAME:$REL_VER"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:latest"
               docker push "$IMG_NAME:latest"
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - |
               git remote add up $GIT_PATH
               git remote -v
               git checkout master
            - |
               git pull --tags
               if git tag -d $REL_VER; then
                 git push --delete up $REL_VER
               fi
            - |
               git checkout $REPO_COMMIT
               git tag $REL_VER
               git push up $REL_VER
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "TAG_COMMIT_SHA=$REPO_COMMIT" "TAG_IMG=$REL_VER"

  - name: u14ruball_x8664_tag
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prod_release
      - IN: u14ruball_dd_repo
        switch: off
      - IN: u14ruball_dd_img
        switch: off
      - IN: shipit_gh_ssh
        switch: off
      - TASK:
          name: u14ruball_tag
          runtime:
            options:
              env:
                - RES_VER: "prod_release"
                - RES_IMG: "u14ruball_dd_img"
                - RES_REPO: "u14ruball_dd_repo"
                - GIT_PATH: "git@github.com:dry-dock/u14ruball.git"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$RES_VER" "versionName")
            - |
               REPO_COMMIT=$(shipctl get_resource_version_key "$RES_IMG" "IMG_REPO_COMMIT_SHA")
               IMG_NAME=$(shipctl get_resource_version_key "$RES_IMG" "sourceName")
               UP_IMG_TAG=$(shipctl get_resource_version_key "$RES_IMG" "versionName")
               DH_USR_NAME=$(shipctl get_integration_resource_field "$RES_IMG" "userName")
               DH_PASS=$(shipctl get_integration_resource_field "$RES_IMG" "password")
            - |
               pushd $(shipctl get_resource_meta "shipit_gh_ssh")
                 shipctl get_json_value integration.json 'privateKey' > gh_ssh.key
                 chmod 600 gh_ssh.key
                 ssh-add gh_ssh.key
               popd
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker pull "$IMG_NAME:$UP_IMG_TAG"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:$REL_VER"
               docker push "$IMG_NAME:$REL_VER"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:latest"
               docker push "$IMG_NAME:latest"
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - |
               git remote add up $GIT_PATH
               git remote -v
               git checkout master
            - |
               git pull --tags
               if git tag -d $REL_VER; then
                 git push --delete up $REL_VER
               fi
            - |
               git checkout $REPO_COMMIT
               git tag $REL_VER
               git push up $REL_VER
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "TAG_COMMIT_SHA=$REPO_COMMIT" "TAG_IMG=$REL_VER"

  - name: u14phpall_x8664_tag
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prod_release
      - IN: u14phpall_dd_repo
        switch: off
      - IN: u14phpall_dd_img
        switch: off
      - IN: shipit_gh_ssh
        switch: off
      - TASK:
          name: u14phpall_tag
          runtime:
            options:
              env:
                - RES_VER: "prod_release"
                - RES_IMG: "u14phpall_dd_img"
                - RES_REPO: "u14phpall_dd_repo"
                - GIT_PATH: "git@github.com:dry-dock/u14phpall.git"
          script:
            - REL_VER=$(shipctl get_resource_version_key "$RES_VER" "versionName")
            - |
               REPO_COMMIT=$(shipctl get_resource_version_key "$RES_IMG" "IMG_REPO_COMMIT_SHA")
               IMG_NAME=$(shipctl get_resource_version_key "$RES_IMG" "sourceName")
               UP_IMG_TAG=$(shipctl get_resource_version_key "$RES_IMG" "versionName")
               DH_USR_NAME=$(shipctl get_integration_resource_field "$RES_IMG" "userName")
               DH_PASS=$(shipctl get_integration_resource_field "$RES_IMG" "password")
            - |
               pushd $(shipctl get_resource_meta "shipit_gh_ssh")
                 shipctl get_json_value integration.json 'privateKey' > gh_ssh.key
                 chmod 600 gh_ssh.key
                 ssh-add gh_ssh.key
               popd
            - docker login -u $DH_USR_NAME -p $DH_PASS
            - docker pull "$IMG_NAME:$UP_IMG_TAG"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:$REL_VER"
               docker push "$IMG_NAME:$REL_VER"
            - |
               docker tag "$IMG_NAME:$UP_IMG_TAG" "$IMG_NAME:latest"
               docker push "$IMG_NAME:latest"
            - pushd $(shipctl get_resource_state "$RES_REPO")
            - |
               git remote add up $GIT_PATH
               git remote -v
               git checkout master
            - |
               git pull --tags
               if git tag -d $REL_VER; then
                 git push --delete up $REL_VER
               fi
            - |
               git checkout $REPO_COMMIT
               git tag $REL_VER
               git push up $REL_VER
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$REL_VER" "TAG_COMMIT_SHA=$REPO_COMMIT" "TAG_IMG=$REL_VER"

######################### GCP U14 Image ##################################
  - name: prep_u14_x8664_d113_gce_img
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: trig_gcp_img_prep
      - IN: u14nodall_dd_img
      - IN: u14pytall_dd_img
      - IN: u14cloall_dd_img
      - IN: u14golall_dd_img
      - IN: u14scaall_dd_img
      - IN: u14ruball_dd_img
      - IN: u14phpall_dd_img
      - IN: u14cppall_dd_img
      - IN: u16cppall_dd_img
      - IN: u16phpall_dd_img
      - IN: u16ruball_dd_img
      - IN: u16scaall_dd_img
      - IN: u16golall_dd_img
      - IN: u16cloall_dd_img
      - IN: u16pytall_dd_img
      - IN: u16nodall_dd_img
      - IN: u16javall_dd_img
      - IN: node_file_pack
      - IN: buildami_repo
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - TASK:
          name: build_gce_image
          runtime:
            options:
              env:
                - NODE_RES: "node_file_pack"
                - SOURCE_IMAGE_FAMILY: "ubuntu-1404-lts"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - REL_VER: "master"
                - SSH_USER: "root"
                - ARCHITECTURE: "x86_64"
                - OS: "Ubuntu_14.04"
                - DOCKER_VER: "1.13"
          script:
            - set -o pipefail
            - |
               export IMG_VER=$REL_VER
               export REL_VER_DASH=${REL_VER//./-}
               DOC_VER_DASH=${DOCKER_VER//./-}
               export FAM_NAME=$REL_VER_DASH"-"$DOC_VER_DASH"-patch-u14-x86-64"
            - |
               TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$WEB_URL/$TAR_FILENAME"
            - pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/prep
            - echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
            - cp -R ../../../templates/linux/* .
            - cp -R ../../../templates/prep/* .
            - shipctl replace vars.json
            - packer validate -var-file=vars.json packer.json
            - packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "NODE_WEB_URL=$WEB_URL" "NODE_TAR_FILENAME=$TAR_FILENAME"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: patch_u14_x8664_d113_gce_img
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prep_u14_x8664_d113_gce_img
      - IN: u14reqProc_dd_img
      - IN: u14repLib_x8664_build
      - IN: reqKick_file_pack
      - IN: cexec_file_pack
      - IN: buildami_repo
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - TASK:
          name: patch_u14_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "prep_u14_x8664_d113_gce_img"
                - REQPROC_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_build"
                - REQKICK_RES: "reqKick_file_pack"
                - CEXEC_RES: "cexec_file_pack"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
          script:
            - set -o pipefail
            - |
               REL_VER=$(shipctl get_resource_version_key "$BASE_IMG_RES" "REL_VER")
               export ARCHITECTURE=$(shipctl get_resource_version_key "$BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "$BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "$BASE_IMG_RES" "DOCKER_VER")
               export SOURCE_IMAGE_FAMILY=$(shipctl get_resource_version_key "$BASE_IMG_RES" "IMAGE_FAM_NAME")
               export NODE_WEB_URL=$(shipctl get_resource_version_key "$BASE_IMG_RES" "NODE_WEB_URL")
               export NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$BASE_IMG_RES" "NODE_TAR_FILENAME")
               export REL_VER_DASH=${REL_VER//./-}
               DOC_VER_DASH=${DOCKER_VER//./-}
               export FAM_NAME=$REL_VER_DASH"-"$DOC_VER_DASH"-patch-u14-x86-64"
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/patch
            - cp -R ../../../templates/linux/* .
            - cp -R ../../../templates/patch/* .
            - shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
            - echo $(shipctl get_integration_resource_field "ship_bits_gcp" "JSON_key") > $SERVICE_ACCOUNT_JSON
            - shipctl replace vars.json
            - packer validate -var-file=vars.json packer.json
            - packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER"
        - shipctl put_resource_state_multi $JOB_NAME "NODE_WEB_URL=$NODE_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME"  "REPORTS_WEB_URL=$REP_WEB_URL" "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME"
        - shipctl put_resource_state_multi $JOB_NAME "REQKICK_WEB_URL=$KICK_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: prep_u14_x8664_gce_img
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: trig_gcp_img_prep
      - IN: u14nodall_dd_img
      - IN: u14pytall_dd_img
      - IN: u14cloall_dd_img
      - IN: u14golall_dd_img
      - IN: u14scaall_dd_img
      - IN: u14ruball_dd_img
      - IN: u14phpall_dd_img
      - IN: u14cppall_dd_img
      - IN: u16cppall_dd_img
      - IN: u16phpall_dd_img
      - IN: u16ruball_dd_img
      - IN: u16scaall_dd_img
      - IN: u16golall_dd_img
      - IN: u16cloall_dd_img
      - IN: u16pytall_dd_img
      - IN: u16nodall_dd_img
      - IN: u16javall_dd_img
      - IN: node_file_pack
      - IN: buildami_repo
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - TASK:
          name: prep_u14_gce_image
          runtime:
            options:
              env:
                - NODE_RES: "node_file_pack"
                - SOURCE_IMAGE_FAMILY: "ubuntu-1404-lts"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - REL_VER: "master"
                - SSH_USER: "root"
                - ARCHITECTURE: "x86_64"
                - OS: "Ubuntu_14.04"
                - DOCKER_VER: "17.06"
          script:
            - set -o pipefail
            - |
               export IMG_VER=$REL_VER
               export REL_VER_DASH=${REL_VER//./-}
               export FAM_NAME=$REL_VER_DASH"-prep-u14-x86-64"
            - |
               TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$WEB_URL/$TAR_FILENAME"
            - pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/prep
            - echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
            - cp -R ../../../templates/linux/* .
            - cp -R ../../../templates/prep/* .
            - shipctl replace vars.json
            - packer validate -var-file=vars.json packer.json
            - packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "NODE_WEB_URL=$WEB_URL" "NODE_TAR_FILENAME=$TAR_FILENAME"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: patch_u14_x8664_gce_img
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: prep_u14_x8664_gce_img
      - IN: u14reqProc_dd_img
      - IN: u14repLib_x8664_build
      - IN: reqKick_file_pack
      - IN: cexec_file_pack
      - IN: buildami_repo
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - TASK:
          name: patch_u14_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "prep_u14_x8664_gce_img"
                - REQPROC_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_build"
                - REQKICK_RES: "reqKick_file_pack"
                - CEXEC_RES: "cexec_file_pack"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
          script:
            - set -o pipefail
            - |
               REL_VER=$(shipctl get_resource_version_key "$BASE_IMG_RES" "REL_VER")
               export ARCHITECTURE=$(shipctl get_resource_version_key "$BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "$BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "$BASE_IMG_RES" "DOCKER_VER")
               export SOURCE_IMAGE_FAMILY=$(shipctl get_resource_version_key "$BASE_IMG_RES" "IMAGE_FAM_NAME")
               export NODE_WEB_URL=$(shipctl get_resource_version_key "$BASE_IMG_RES" "NODE_WEB_URL")
               export NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$BASE_IMG_RES" "NODE_TAR_FILENAME")
               export REL_VER_DASH=${REL_VER//./-}
               export FAM_NAME=$REL_VER_DASH"-patch-u14-x86-64"
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/patch
            - cp -R ../../../templates/linux/* .
            - cp -R ../../../templates/patch/* .
            - shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
            - echo $(shipctl get_integration_resource_field "ship_bits_gcp" "JSON_key") > $SERVICE_ACCOUNT_JSON
            - shipctl replace vars.json
            - packer validate -var-file=vars.json packer.json
            - packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER"
        - shipctl put_resource_state_multi $JOB_NAME "NODE_WEB_URL=$NODE_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME"  "REPORTS_WEB_URL=$REP_WEB_URL" "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME"
        - shipctl put_resource_state_multi $JOB_NAME "REQKICK_WEB_URL=$KICK_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: final_u14_x8664_gce_img
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: u14_x8664_tag
      - IN: u14all_x8664_tag
      - IN: u14nodall_x8664_tag
      - IN: u14pytall_x8664_tag
      - IN: u14javall_x8664_tag
      - IN: u14cppall_x8664_tag
      - IN: u14cloall_x8664_tag
      - IN: u14golall_x8664_tag
      - IN: u14scaall_x8664_tag
      - IN: u14ruball_x8664_tag
      - IN: u14phpall_x8664_tag
      - IN: u14microbase_x8664_tag
      - IN: u16_x8664_tag
      - IN: u16all_x8664_tag
      - IN: u16nodall_x8664_tag
      - IN: u16pytall_x8664_tag
      - IN: u16javall_x8664_tag
      - IN: u16cppall_x8664_tag
      - IN: u16cloall_x8664_tag
      - IN: u16golall_x8664_tag
      - IN: u16scaall_x8664_tag
      - IN: u16ruball_x8664_tag
      - IN: u16phpall_x8664_tag
      - IN: u16microbase_x8664_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqKick_repo_file_tag
      - IN: u14reqProc_dd_tag
      - IN: u14reqProc_dd_img
      - IN: u14repLib_x8664_tag
      - IN: buildami_repo
        switch: off
      - IN: patch_u14_x8664_gce_img
        switch: off
      - IN: prod_release
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - TASK:
          name: final_u14_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "patch_u14_x8664_gce_img"
                - NODE_RES: "node_repo_file_tag"
                - REQPROC_RES: "u14reqProc_dd_tag"
                - REQPROC_IMG_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_tag"
                - REQKICK_RES: "reqKick_repo_file_tag"
                - CEXEC_RES: "cexec_repo_file_tag"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
          script:
            - set -o pipefail
            - |
               export REL_VER=$(shipctl get_resource_version_name "prod_release")
               export IMG_VER=$REL_VER
               export REL_VER_DASH=${REL_VER//./-}
               export FAM_NAME=$REL_VER_DASH"-final-u14-x86-64"
            - |
               export SOURCE_IMAGE_FAMILY=$(shipctl get_resource_version_key "BASE_IMG_RES" "IMAGE_FAM_NAME")
               export ARCHITECTURE=$(shipctl get_resource_version_key "BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "BASE_IMG_RES" "DOCKER_VER")
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_IMG_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               NODE_WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$NODE_WEB_URL/$NODE_TAR_FILENAME"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - |
               pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/final
               cp -R ../../../templates/linux/* .
               cp -R ../../../templates/final/* .
               shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
               echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
               shipctl replace vars.json
               packer validate -var-file=vars.json packer.json
               packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "IMG_VER=$IMG_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "REQPROC_REG=$REQPROC_REG"
        - shipctl put_resource_state_multi $JOB_NAME "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME" "REPORTS_WEB_URL=$REP_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "REQKICK_WEB_URL=$KICK_WEB_URL"
        - shipctl put_resource_state_multi $JOB_NAME "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME" "NODE_WEB_URL=$NODE_WEB_URL"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: v532_u14_x8664_gce_img
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: u14repLib_x8664_tag
      - IN: u14reqProc_dd_tag
      - IN: u14reqProc_dd_img
        switch: off
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - IN: patch_u14_x8664_d113_gce_img
        switch: off
      - TASK:
          name: build_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "patch_u14_x8664_d113_gce_img"
                - NODE_RES: "node_repo_file_tag"
                - REQPROC_RES: "u14reqProc_dd_tag"
                - REQPROC_IMG_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_tag"
                - REQKICK_RES: "reqKick_repo_file_tag"
                - CEXEC_RES: "cexec_repo_file_tag"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
                - IMG_VER: "v5.3.2"
          script:
            - set -o pipefail
            - |
               export REL_VER=$(shipctl get_resource_version_name "prod_release")
               export IMG_VER_DASH=${IMG_VER//./-}
               export FAM_NAME=$IMG_VER_DASH"-final-u14-x86-64"
               export SOURCE_IMAGE_FAMILY=$FAM_NAME
            - |
               export ARCHITECTURE=$(shipctl get_resource_version_key "BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "BASE_IMG_RES" "DOCKER_VER")
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_IMG_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               NODE_WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$NODE_WEB_URL/$NODE_TAR_FILENAME"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - |
               pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/final
               cp -R ../../../templates/linux/* .
               cp -R ../../../templates/final/* .
               shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
               echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
               shipctl replace vars.json
               packer validate -var-file=vars.json packer.json
               packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "IMG_VER=$IMG_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "REQPROC_REG=$REQPROC_REG"
        - shipctl put_resource_state_multi $JOB_NAME "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME" "REPORTS_WEB_URL=$REP_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "REQKICK_WEB_URL=$KICK_WEB_URL"
        - shipctl put_resource_state_multi $JOB_NAME "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME" "NODE_WEB_URL=$NODE_WEB_URL"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: v541_u14_x8664_gce_img
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: u14repLib_x8664_tag
      - IN: u14reqProc_dd_tag
      - IN: u14reqProc_dd_img
        switch: off
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - IN: patch_u14_x8664_d113_gce_img
        switch: off
      - TASK:
          name: build_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "patch_u14_x8664_d113_gce_img"
                - NODE_RES: "node_repo_file_tag"
                - REQPROC_RES: "u14reqProc_dd_tag"
                - REQPROC_IMG_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_tag"
                - REQKICK_RES: "reqKick_repo_file_tag"
                - CEXEC_RES: "cexec_repo_file_tag"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
                - IMG_VER: "v5.4.1"
          script:
            - set -o pipefail
            - |
               export REL_VER=$(shipctl get_resource_version_name "prod_release")
               export IMG_VER_DASH=${IMG_VER//./-}
               export FAM_NAME=$IMG_VER_DASH"-final-u14-x86-64"
               export SOURCE_IMAGE_FAMILY=$FAM_NAME
            - |
               export ARCHITECTURE=$(shipctl get_resource_version_key "BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "BASE_IMG_RES" "DOCKER_VER")
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_IMG_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               NODE_WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$NODE_WEB_URL/$NODE_TAR_FILENAME"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - |
               pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/final
               cp -R ../../../templates/linux/* .
               cp -R ../../../templates/final/* .
               shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
               echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
               shipctl replace vars.json
               packer validate -var-file=vars.json packer.json
               packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "IMG_VER=$IMG_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "REQPROC_REG=$REQPROC_REG"
        - shipctl put_resource_state_multi $JOB_NAME "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME" "REPORTS_WEB_URL=$REP_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "REQKICK_WEB_URL=$KICK_WEB_URL"
        - shipctl put_resource_state_multi $JOB_NAME "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME" "NODE_WEB_URL=$NODE_WEB_URL"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: v551_u14_x8664_gce_img
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: u14repLib_x8664_tag
      - IN: u14reqProc_dd_tag
      - IN: u14reqProc_dd_img
        switch: off
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - IN: patch_u14_x8664_d113_gce_img
        switch: off
      - TASK:
          name: build_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "patch_u14_x8664_d113_gce_img"
                - NODE_RES: "node_repo_file_tag"
                - REQPROC_RES: "u14reqProc_dd_tag"
                - REQPROC_IMG_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_tag"
                - REQKICK_RES: "reqKick_repo_file_tag"
                - CEXEC_RES: "cexec_repo_file_tag"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
                - IMG_VER: "v5.5.1"
          script:
            - set -o pipefail
            - |
               export REL_VER=$(shipctl get_resource_version_name "prod_release")
               export IMG_VER_DASH=${IMG_VER//./-}
               export FAM_NAME=$IMG_VER_DASH"-final-u14-x86-64"
               export SOURCE_IMAGE_FAMILY=$FAM_NAME
            - |
               export ARCHITECTURE=$(shipctl get_resource_version_key "BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "BASE_IMG_RES" "DOCKER_VER")
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_IMG_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               NODE_WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$NODE_WEB_URL/$NODE_TAR_FILENAME"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - |
               pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/final
               cp -R ../../../templates/linux/* .
               cp -R ../../../templates/final/* .
               shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
               echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
               shipctl replace vars.json
               packer validate -var-file=vars.json packer.json
               packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "IMG_VER=$IMG_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "REQPROC_REG=$REQPROC_REG"
        - shipctl put_resource_state_multi $JOB_NAME "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME" "REPORTS_WEB_URL=$REP_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "REQKICK_WEB_URL=$KICK_WEB_URL"
        - shipctl put_resource_state_multi $JOB_NAME "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME" "NODE_WEB_URL=$NODE_WEB_URL"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: v561_u14_x8664_gce_img
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: u14repLib_x8664_tag
      - IN: u14reqProc_dd_tag
      - IN: u14reqProc_dd_img
        switch: off
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - IN: patch_u14_x8664_d113_gce_img
        switch: off
      - TASK:
          name: build_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "patch_u14_x8664_d113_gce_img"
                - NODE_RES: "node_repo_file_tag"
                - REQPROC_RES: "u14reqProc_dd_tag"
                - REQPROC_IMG_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_tag"
                - REQKICK_RES: "reqKick_repo_file_tag"
                - CEXEC_RES: "cexec_repo_file_tag"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
                - IMG_VER: "v5.6.1"
          script:
            - set -o pipefail
            - |
               export REL_VER=$(shipctl get_resource_version_name "prod_release")
               export IMG_VER_DASH=${IMG_VER//./-}
               export FAM_NAME=$IMG_VER_DASH"-final-u14-x86-64"
               export SOURCE_IMAGE_FAMILY=$FAM_NAME
            - |
               export ARCHITECTURE=$(shipctl get_resource_version_key "BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "BASE_IMG_RES" "DOCKER_VER")
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_IMG_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               NODE_WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$NODE_WEB_URL/$NODE_TAR_FILENAME"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - |
               pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/final
               cp -R ../../../templates/linux/* .
               cp -R ../../../templates/final/* .
               shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
               echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
               shipctl replace vars.json
               packer validate -var-file=vars.json packer.json
               packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "IMG_VER=$IMG_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "REQPROC_REG=$REQPROC_REG"
        - shipctl put_resource_state_multi $JOB_NAME "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME" "REPORTS_WEB_URL=$REP_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "REQKICK_WEB_URL=$KICK_WEB_URL"
        - shipctl put_resource_state_multi $JOB_NAME "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME" "NODE_WEB_URL=$NODE_WEB_URL"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: v573_u14_x8664_gce_img
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: u14repLib_x8664_tag
      - IN: u14reqProc_dd_tag
      - IN: u14reqProc_dd_img
        switch: off
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - IN: patch_u14_x8664_d113_gce_img
        switch: off
      - TASK:
          name: build_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "patch_u14_x8664_d113_gce_img"
                - NODE_RES: "node_repo_file_tag"
                - REQPROC_RES: "u14reqProc_dd_tag"
                - REQPROC_IMG_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_tag"
                - REQKICK_RES: "reqKick_repo_file_tag"
                - CEXEC_RES: "cexec_repo_file_tag"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
                - IMG_VER: "v5.7.3"
          script:
            - set -o pipefail
            - |
               export REL_VER=$(shipctl get_resource_version_name "prod_release")
               export IMG_VER_DASH=${IMG_VER//./-}
               export FAM_NAME=$IMG_VER_DASH"-final-u14-x86-64"
               export SOURCE_IMAGE_FAMILY=$FAM_NAME
            - |
               export ARCHITECTURE=$(shipctl get_resource_version_key "BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "BASE_IMG_RES" "DOCKER_VER")
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_IMG_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               NODE_WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$NODE_WEB_URL/$NODE_TAR_FILENAME"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - |
               pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/final
               cp -R ../../../templates/linux/* .
               cp -R ../../../templates/final/* .
               shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
               echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
               shipctl replace vars.json
               packer validate -var-file=vars.json packer.json
               packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "IMG_VER=$IMG_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "REQPROC_REG=$REQPROC_REG"
        - shipctl put_resource_state_multi $JOB_NAME "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME" "REPORTS_WEB_URL=$REP_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "REQKICK_WEB_URL=$KICK_WEB_URL"
        - shipctl put_resource_state_multi $JOB_NAME "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME" "NODE_WEB_URL=$NODE_WEB_URL"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: v582_u14_x8664_gce_img
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: u14repLib_x8664_tag
      - IN: u14reqProc_dd_tag
      - IN: u14reqProc_dd_img
        switch: off
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - IN: patch_u14_x8664_d113_gce_img
        switch: off
      - TASK:
          name: build_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "patch_u14_x8664_d113_gce_img"
                - NODE_RES: "node_repo_file_tag"
                - REQPROC_RES: "u14reqProc_dd_tag"
                - REQPROC_IMG_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_tag"
                - REQKICK_RES: "reqKick_repo_file_tag"
                - CEXEC_RES: "cexec_repo_file_tag"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
                - IMG_VER: "v5.8.2"
          script:
            - set -o pipefail
            - |
               export REL_VER=$(shipctl get_resource_version_name "prod_release")
               export IMG_VER_DASH=${IMG_VER//./-}
               export FAM_NAME=$IMG_VER_DASH"-final-u14-x86-64"
               export SOURCE_IMAGE_FAMILY=$FAM_NAME
            - |
               export ARCHITECTURE=$(shipctl get_resource_version_key "BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "BASE_IMG_RES" "DOCKER_VER")
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_IMG_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               NODE_WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$NODE_WEB_URL/$NODE_TAR_FILENAME"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - |
               pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/final
               cp -R ../../../templates/linux/* .
               cp -R ../../../templates/final/* .
               shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
               echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
               shipctl replace vars.json
               packer validate -var-file=vars.json packer.json
               packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "IMG_VER=$IMG_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "REQPROC_REG=$REQPROC_REG"
        - shipctl put_resource_state_multi $JOB_NAME "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME" "REPORTS_WEB_URL=$REP_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "REQKICK_WEB_URL=$KICK_WEB_URL"
        - shipctl put_resource_state_multi $JOB_NAME "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME" "NODE_WEB_URL=$NODE_WEB_URL"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: v5104_u14_x8664_gce_img
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: u14repLib_x8664_tag
      - IN: u14reqProc_dd_tag
      - IN: u14reqProc_dd_img
        switch: off
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - IN: patch_u14_x8664_d113_gce_img
        switch: off
      - TASK:
          name: build_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "patch_u14_x8664_d113_gce_img"
                - NODE_RES: "node_repo_file_tag"
                - REQPROC_RES: "u14reqProc_dd_tag"
                - REQPROC_IMG_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_tag"
                - REQKICK_RES: "reqKick_repo_file_tag"
                - CEXEC_RES: "cexec_repo_file_tag"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
                - IMG_VER: "v5.10.4"
          script:
            - set -o pipefail
            - |
               export REL_VER=$(shipctl get_resource_version_name "prod_release")
               export IMG_VER_DASH=${IMG_VER//./-}
               export FAM_NAME=$IMG_VER_DASH"-final-u14-x86-64"
               export SOURCE_IMAGE_FAMILY=$FAM_NAME
            - |
               export ARCHITECTURE=$(shipctl get_resource_version_key "BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "BASE_IMG_RES" "DOCKER_VER")
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_IMG_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               NODE_WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$NODE_WEB_URL/$NODE_TAR_FILENAME"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - |
               pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/final
               cp -R ../../../templates/linux/* .
               cp -R ../../../templates/final/* .
               shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
               echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
               shipctl replace vars.json
               packer validate -var-file=vars.json packer.json
               packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "IMG_VER=$IMG_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "REQPROC_REG=$REQPROC_REG"
        - shipctl put_resource_state_multi $JOB_NAME "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME" "REPORTS_WEB_URL=$REP_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "REQKICK_WEB_URL=$KICK_WEB_URL"
        - shipctl put_resource_state_multi $JOB_NAME "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME" "NODE_WEB_URL=$NODE_WEB_URL"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: v614_u14_x8664_gce_img
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: u14repLib_x8664_tag
      - IN: u14reqProc_dd_tag
      - IN: u14reqProc_dd_img
        switch: off
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - IN: patch_u14_x8664_d113_gce_img
        switch: off
      - TASK:
          name: build_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "patch_u14_x8664_d113_gce_img"
                - NODE_RES: "node_repo_file_tag"
                - REQPROC_RES: "u14reqProc_dd_tag"
                - REQPROC_IMG_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_tag"
                - REQKICK_RES: "reqKick_repo_file_tag"
                - CEXEC_RES: "cexec_repo_file_tag"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
                - IMG_VER: "v6.1.4"
          script:
            - set -o pipefail
            - |
               export REL_VER=$(shipctl get_resource_version_name "prod_release")
               export IMG_VER_DASH=${IMG_VER//./-}
               export FAM_NAME=$IMG_VER_DASH"-final-u14-x86-64"
               export SOURCE_IMAGE_FAMILY=$FAM_NAME
            - |
               export ARCHITECTURE=$(shipctl get_resource_version_key "BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "BASE_IMG_RES" "DOCKER_VER")
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_IMG_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               NODE_WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$NODE_WEB_URL/$NODE_TAR_FILENAME"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - |
               pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/final
               cp -R ../../../templates/linux/* .
               cp -R ../../../templates/final/* .
               shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
               echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
               shipctl replace vars.json
               packer validate -var-file=vars.json packer.json
               packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "IMG_VER=$IMG_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "REQPROC_REG=$REQPROC_REG"
        - shipctl put_resource_state_multi $JOB_NAME "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME" "REPORTS_WEB_URL=$REP_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "REQKICK_WEB_URL=$KICK_WEB_URL"
        - shipctl put_resource_state_multi $JOB_NAME "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME" "NODE_WEB_URL=$NODE_WEB_URL"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: v624_u14_x8664_gce_img
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: u14repLib_x8664_tag
      - IN: u14reqProc_dd_tag
      - IN: u14reqProc_dd_img
        switch: off
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - IN: patch_u14_x8664_d113_gce_img
        switch: off
      - TASK:
          name: build_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "patch_u14_x8664_d113_gce_img"
                - NODE_RES: "node_repo_file_tag"
                - REQPROC_RES: "u14reqProc_dd_tag"
                - REQPROC_IMG_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_tag"
                - REQKICK_RES: "reqKick_repo_file_tag"
                - CEXEC_RES: "cexec_repo_file_tag"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
                - IMG_VER: "v6.2.4"
          script:
            - set -o pipefail
            - |
               export REL_VER=$(shipctl get_resource_version_name "prod_release")
               export IMG_VER_DASH=${IMG_VER//./-}
               export FAM_NAME=$IMG_VER_DASH"-final-u14-x86-64"
               export SOURCE_IMAGE_FAMILY=$FAM_NAME
            - |
               export ARCHITECTURE=$(shipctl get_resource_version_key "BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "BASE_IMG_RES" "DOCKER_VER")
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_IMG_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               NODE_WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$NODE_WEB_URL/$NODE_TAR_FILENAME"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - |
               pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/final
               cp -R ../../../templates/linux/* .
               cp -R ../../../templates/final/* .
               shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
               echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
               shipctl replace vars.json
               packer validate -var-file=vars.json packer.json
               packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "IMG_VER=$IMG_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "REQPROC_REG=$REQPROC_REG"
        - shipctl put_resource_state_multi $JOB_NAME "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME" "REPORTS_WEB_URL=$REP_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "REQKICK_WEB_URL=$KICK_WEB_URL"
        - shipctl put_resource_state_multi $JOB_NAME "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME" "NODE_WEB_URL=$NODE_WEB_URL"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: v634_u14_x8664_gce_img
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: u14repLib_x8664_tag
      - IN: u14reqProc_dd_tag
      - IN: u14reqProc_dd_img
        switch: off
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - IN: patch_u14_x8664_d113_gce_img
        switch: off
      - TASK:
          name: build_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "patch_u14_x8664_d113_gce_img"
                - NODE_RES: "node_repo_file_tag"
                - REQPROC_RES: "u14reqProc_dd_tag"
                - REQPROC_IMG_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_tag"
                - REQKICK_RES: "reqKick_repo_file_tag"
                - CEXEC_RES: "cexec_repo_file_tag"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
                - IMG_VER: "v6.3.4"
          script:
            - set -o pipefail
            - |
               export REL_VER=$(shipctl get_resource_version_name "prod_release")
               export IMG_VER_DASH=${IMG_VER//./-}
               export FAM_NAME=$IMG_VER_DASH"-final-u14-x86-64"
               export SOURCE_IMAGE_FAMILY=$FAM_NAME
            - |
               export ARCHITECTURE=$(shipctl get_resource_version_key "BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "BASE_IMG_RES" "DOCKER_VER")
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_IMG_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               NODE_WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$NODE_WEB_URL/$NODE_TAR_FILENAME"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - |
               pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/final
               cp -R ../../../templates/linux/* .
               cp -R ../../../templates/final/* .
               shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
               echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
               shipctl replace vars.json
               packer validate -var-file=vars.json packer.json
               packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "IMG_VER=$IMG_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "REQPROC_REG=$REQPROC_REG"
        - shipctl put_resource_state_multi $JOB_NAME "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME" "REPORTS_WEB_URL=$REP_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "REQKICK_WEB_URL=$KICK_WEB_URL"
        - shipctl put_resource_state_multi $JOB_NAME "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME" "NODE_WEB_URL=$NODE_WEB_URL"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

  - name: v644_u14_x8664_gce_img
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: u14repLib_x8664_tag
      - IN: u14reqProc_dd_tag
      - IN: u14reqProc_dd_img
        switch: off
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: ship_bits_gcp
        switch: off
      - IN: patch_u14_x8664_d113_gce_img
        switch: off
      - TASK:
          name: build_gce_image
          runtime:
            options:
              env:
                - BASE_IMG_RES: "patch_u14_x8664_d113_gce_img"
                - NODE_RES: "node_repo_file_tag"
                - REQPROC_RES: "u14reqProc_dd_tag"
                - REQPROC_IMG_RES: "u14reqProc_dd_img"
                - REPORTS_RES: "u14repLib_x8664_tag"
                - REQKICK_RES: "reqKick_repo_file_tag"
                - CEXEC_RES: "cexec_repo_file_tag"
                - MACHINE_TYPE: "n1-standard-8"
                - REGION: "us-east1"
                - ZONE: "us-east1-b"
                - PROJECT_ID: "ship-bits"
                - SERVICE_ACCOUNT_JSON: "gcp_key.json"
                - SSH_USER: "root"
                - IMG_VER: "v6.4.4"
          script:
            - set -o pipefail
            - |
               export REL_VER=$(shipctl get_resource_version_name "prod_release")
               export IMG_VER_DASH=${IMG_VER//./-}
               export FAM_NAME=$IMG_VER_DASH"-final-u14-x86-64"
               export SOURCE_IMAGE_FAMILY=$FAM_NAME
            - |
               export ARCHITECTURE=$(shipctl get_resource_version_key "BASE_IMG_RES" "ARCHITECTURE")
               export OS=$(shipctl get_resource_version_key "BASE_IMG_RES" "OS")
               export DOCKER_VER=$(shipctl get_resource_version_key "BASE_IMG_RES" "DOCKER_VER")
            - |
               REQPROC_REG=$(shipctl get_resource_version_key "$REQPROC_IMG_RES" "sourceName")
               REQPROC_TAG=$(shipctl get_resource_version_key "$REQPROC_RES" "versionName")
               export REQPROC_IMAGE="$REQPROC_REG:$REQPROC_TAG"
            - |
               NODE_TAR_FILENAME=$(shipctl get_resource_version_key "$NODE_RES" "TAR_FILENAME")
               NODE_WEB_URL=$(shipctl get_resource_version_key "$NODE_RES" "WEB_URL")
               export NODE_DOWNLOAD_URL="$NODE_WEB_URL/$NODE_TAR_FILENAME"
            - |
               REP_TAR_FILENAME=$(shipctl get_resource_version_key "$REPORTS_RES" "TAR_FILENAME")
               REP_WEB_URL=$(shipctl get_resource_version_key "$REPORTS_RES" "WEB_URL")
               export REPORTS_DOWNLOAD_URL="$REP_WEB_URL/$REL_VER/$REP_TAR_FILENAME"
            - |
               KICK_TAR_FILENAME=$(shipctl get_resource_version_key "$REQKICK_RES" "TAR_FILENAME")
               KICK_WEB_URL=$(shipctl get_resource_version_key "$REQKICK_RES" "WEB_URL")
               export REQKICK_DOWNLOAD_URL="$KICK_WEB_URL/$KICK_TAR_FILENAME"
            - |
               CEXEC_TAR_FILENAME=$(shipctl get_resource_version_key "$CEXEC_RES" "TAR_FILENAME")
               CEXEC_WEB_URL=$(shipctl get_resource_version_key "$CEXEC_RES" "WEB_URL")
               export CEXEC_DOWNLOAD_URL="$CEXEC_WEB_URL/$CEXEC_TAR_FILENAME"
            - |
               pushd $(shipctl get_resource_state "buildami_repo")/gcp/$ARCHITECTURE/$OS/final
               cp -R ../../../templates/linux/* .
               cp -R ../../../templates/final/* .
               shipctl copy_file_from_resource_state "$BASE_IMG_RES" "images.txt" .
               echo $(shipctl get_integration_resource_field ship_bits_gcp JSON_key) > $SERVICE_ACCOUNT_JSON
               shipctl replace vars.json
               packer validate -var-file=vars.json packer.json
               packer build -machine-readable -var-file=vars.json packer.json 2>&1 | tee output.txt
            - export IMAGE_NAME=$(cat output.txt | awk -F, '$0 ~/artifact,0,id/ {print $6}' | cut -d':' -f 2)
    on_success:
      script:
        - shipctl put_resource_state_multi $JOB_NAME "versionName=$IMAGE_NAME" "IMAGE_NAME=$IMAGE_NAME" "IMAGE_FAM_NAME=$FAM_NAME" "REL_VER=$REL_VER" "IMG_VER=$IMG_VER"
        - shipctl put_resource_state_multi $JOB_NAME "ARCHITECTURE=$ARCHITECTURE" "OS=$OS" "DOCKER_VER=$DOCKER_VER" "REQPROC_REG=$REQPROC_REG"
        - shipctl put_resource_state_multi $JOB_NAME "REPORTS_TAR_FILENAME=$REP_TAR_FILENAME" "REPORTS_WEB_URL=$REP_WEB_URL" "REQKICK_TAR_FILENAME=$KICK_TAR_FILENAME" "REQKICK_WEB_URL=$KICK_WEB_URL"
        - shipctl put_resource_state_multi $JOB_NAME "CEXEC_TAR_FILENAME=$CEXEC_TAR_FILENAME" "CEXEC_WEB_URL=$CEXEC_WEB_URL" "NODE_TAR_FILENAME=$NODE_TAR_FILENAME" "NODE_WEB_URL=$NODE_WEB_URL"
        - shipctl copy_file_to_state images.txt
    on_failure:
      script:
        - cat output.txt

#### AWS

  - name: baseami_prep
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: buildami_repo
        switch: off
      - IN: ami_bits_access_cli
        switch: off
      - IN: baseami_params
        switch: off
      - IN: u16cppall_dd_img
      - IN: u16phpall_dd_img
      - IN: u16ruball_dd_img
      - IN: u16scaall_dd_img
      - IN: u16golall_dd_img
      - IN: u16cloall_dd_img
      - IN: u16pytall_dd_img
      - IN: u16nodall_dd_img
      - IN: u16javall_dd_img
      - IN: u14nodall_dd_img
      - IN: u14pytall_dd_img
      - IN: u14cloall_dd_img
      - IN: u14golall_dd_img
      - IN: u14scaall_dd_img
      - IN: u14ruball_dd_img
      - IN: u14phpall_dd_img
      - IN: u14cppall_dd_img
      - IN: u14javall_dd_img
      - IN: node_file_pack
      - IN: cexec_file_pack
      - IN: u14reqProc_x8664_build
      - IN: ami_reqKick_repo
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd base
            - ./basePack.sh baseami_prep ami_bits_access_cli
            - popd
    on_failure:
      - script: cat IN/buildami_repo/gitRepo/base/output.txt #TODO change to standard syntax

  - name: baseami_patch
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: buildami_repo
        switch: off
      - IN: ami_bits_access_cli
        switch: off
      - IN: baseami_params
        switch: off
      - IN: cexec_file_pack
      - IN: node_file_pack
      - IN: u14reqProc_x8664_build
      - IN: ami_reqKick_repo
      - IN: baseami_prep
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd basePatch
            - ./basePatchPack.sh baseami_patch ami_bits_access_cli baseami_prep
            - popd
    on_failure:
      - script: cat IN/buildami_repo/gitRepo/basePatch/output.txt #TODO change to standard syntax

  - name: finalami_prep
    type: runSh
    triggerMode: parallel
    dependencyMode: strict
    steps:
      - IN: u14_x8664_tag
      - IN: u14all_x8664_tag
      - IN: u14nodall_x8664_tag
      - IN: u14pytall_x8664_tag
      - IN: u14javall_x8664_tag
      - IN: u14cppall_x8664_tag
      - IN: u14cloall_x8664_tag
      - IN: u14golall_x8664_tag
      - IN: u14scaall_x8664_tag
      - IN: u14ruball_x8664_tag
      - IN: u14phpall_x8664_tag
      - IN: u14microbase_x8664_tag
      - IN: u16_x8664_tag
      - IN: u16all_x8664_tag
      - IN: u16nodall_x8664_tag
      - IN: u16pytall_x8664_tag
      - IN: u16javall_x8664_tag
      - IN: u16cppall_x8664_tag
      - IN: u16cloall_x8664_tag
      - IN: u16golall_x8664_tag
      - IN: u16scaall_x8664_tag
      - IN: u16ruball_x8664_tag
      - IN: u16phpall_x8664_tag
      - IN: u16microbase_x8664_tag
      - IN: execTemplates_repo_file_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqExec_repo_tag
      - IN: reqProc_repo_tag
      - IN: c7repLib_x8664_tag
      - IN: u14repLib_x8664_tag
      - IN: u16repLib_x8664_tag
      - IN: u16repLib_aarch64_tag
      - IN: buildami_repo
        switch: off
      - IN: baseami_patch
        switch: off
      - IN: prod_release
        switch: off
      - IN: baseami_params
        switch: off
      - IN: ami_bits_access
        switch: off
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd exec
            - ./execPack.sh finalami_prep prod_release baseami_patch ami_bits_access
            - popd
    on_failure:
      - script: cat /build/IN/buildami_repo/gitRepo/exec/output.txt

  - name: stable_update
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: baseami_params
        switch: off
      - IN: ami_bits_access
        switch: off
      - IN: execTemplates_repo_file_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqExec_repo_tag
      - IN: reqProc_repo_tag
      - IN: c7repLib_x8664_tag
      - IN: u14repLib_x8664_tag
      - IN: u16repLib_x8664_tag
      - IN: u16repLib_aarch64_tag
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd exec
            - ./execPackUpdate.sh stable_update prod_release ami-4ae41a5c stable ami_bits_access
            - popd
    on_failure:
      - script: cat /build/IN/buildami_repo/gitRepo/exec/output.txt

  - name: unstable_update
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: baseami_params
        switch: off
      - IN: ami_bits_access
        switch: off
      - IN: execTemplates_repo_file_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqExec_repo_tag
      - IN: reqProc_repo_tag
      - IN: c7repLib_x8664_tag
      - IN: u14repLib_x8664_tag
      - IN: u16repLib_x8664_tag
      - IN: u16repLib_aarch64_tag
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd exec
            - ./execPackUpdate.sh unstable_update prod_release ami-90fd0286 unstable ami_bits_access
            - popd
    on_failure:
      - script: cat /build/IN/buildami_repo/gitRepo/exec/output.txt

  - name: v532_update
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: baseami_params
        switch: off
      - IN: ami_bits_access
        switch: off
      - IN: execTemplates_repo_file_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqExec_repo_tag
      - IN: reqProc_repo_tag
      - IN: c7repLib_x8664_tag
      - IN: u14repLib_x8664_tag
      - IN: u16repLib_x8664_tag
      - IN: u16repLib_aarch64_tag
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd exec
            - ./execPackUpdate.sh v532_update prod_release ami-3b972d2d v532 ami_bits_access
            - popd
    on_failure:
      - script: cat /build/IN/buildami_repo/gitRepo/exec/output.txt

  - name: v541_update
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: baseami_params
        switch: off
      - IN: ami_bits_access
        switch: off
      - IN: execTemplates_repo_file_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqExec_repo_tag
      - IN: reqProc_repo_tag
      - IN: c7repLib_x8664_tag
      - IN: u14repLib_x8664_tag
      - IN: u16repLib_x8664_tag
      - IN: u16repLib_aarch64_tag
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd exec
            - ./execPackUpdate.sh v541_update prod_release ami-90813b86 v541 ami_bits_access
            - popd
    on_failure:
      - script: cat /build/IN/buildami_repo/gitRepo/exec/output.txt

  - name: v551_update
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: baseami_params
        switch: off
      - IN: ami_bits_access
        switch: off
      - IN: execTemplates_repo_file_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqExec_repo_tag
      - IN: reqProc_repo_tag
      - IN: c7repLib_x8664_tag
      - IN: u14repLib_x8664_tag
      - IN: u16repLib_x8664_tag
      - IN: u16repLib_aarch64_tag
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd exec
            - ./execPackUpdate.sh v551_update prod_release ami-4b36535d v551 ami_bits_access
            - popd
    on_failure:
      - script: cat /build/IN/buildami_repo/gitRepo/exec/output.txt

  - name: v561_update
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: baseami_params
        switch: off
      - IN: ami_bits_access
        switch: off
      - IN: execTemplates_repo_file_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqExec_repo_tag
      - IN: reqProc_repo_tag
      - IN: c7repLib_x8664_tag
      - IN: u14repLib_x8664_tag
      - IN: u16repLib_x8664_tag
      - IN: u16repLib_aarch64_tag
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd exec
            - ./execPackUpdate.sh v561_update prod_release ami-c0a5f5d6 v561 ami_bits_access
            - popd
    on_failure:
      - script: cat /build/IN/buildami_repo/gitRepo/exec/output.txt

  - name: v573_update
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: baseami_params
        switch: off
      - IN: ami_bits_access
        switch: off
      - IN: execTemplates_repo_file_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqExec_repo_tag
      - IN: reqProc_repo_tag
      - IN: c7repLib_x8664_tag
      - IN: u14repLib_x8664_tag
      - IN: u16repLib_x8664_tag
      - IN: u16repLib_aarch64_tag
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd exec
            - ./execPackUpdate.sh v573_update prod_release ami-b9cfdeaf v573 ami_bits_access
            - popd
    on_failure:
      - script: cat /build/IN/buildami_repo/gitRepo/exec/output.txt

  - name: v582_update
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: baseami_params
        switch: off
      - IN: ami_bits_access
        switch: off
      - IN: execTemplates_repo_file_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqExec_repo_tag
      - IN: reqProc_repo_tag
      - IN: c7repLib_x8664_tag
      - IN: u14repLib_x8664_tag
      - IN: u16repLib_x8664_tag
      - IN: u16repLib_aarch64_tag
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd exec
            - ./execPackUpdate.sh v582_update prod_release ami-f9d6e782 v582 ami_bits_access
            - popd
    on_failure:
      - script: cat /build/IN/buildami_repo/gitRepo/exec/output.txt

  - name: v5104_update
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: baseami_params
        switch: off
      - IN: ami_bits_access
        switch: off
      - IN: execTemplates_repo_file_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqExec_repo_tag
      - IN: reqProc_repo_tag
      - IN: c7repLib_x8664_tag
      - IN: u14repLib_x8664_tag
      - IN: u16repLib_x8664_tag
      - IN: u16repLib_aarch64_tag
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd exec
            - ./execPackUpdate.sh v5104_update prod_release ami-312b8d4b v5104 ami_bits_access
            - popd
    on_failure:
      - script: cat /build/IN/buildami_repo/gitRepo/exec/output.txt

  - name: v614_update
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: baseami_params
        switch: off
      - IN: ami_bits_access
        switch: off
      - IN: execTemplates_repo_file_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqExec_repo_tag
      - IN: reqProc_repo_tag
      - IN: c7repLib_x8664_tag
      - IN: u14repLib_x8664_tag
      - IN: u16repLib_x8664_tag
      - IN: u16repLib_aarch64_tag
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd exec
            - ./execPackUpdate.sh v614_update prod_release ami-874d4bfd v614 ami_bits_access
            - popd
    on_failure:
      - script: cat /build/IN/buildami_repo/gitRepo/exec/output.txt

  - name: v624_update
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: baseami_params
        switch: off
      - IN: ami_bits_access
        switch: off
      - IN: execTemplates_repo_file_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqExec_repo_tag
      - IN: reqProc_repo_tag
      - IN: c7repLib_x8664_tag
      - IN: u14repLib_x8664_tag
      - IN: u16repLib_x8664_tag
      - IN: u16repLib_aarch64_tag
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd exec
            - ./execPackUpdate.sh v624_update prod_release ami-32d5274f v624 ami_bits_access
            - popd
    on_failure:
      - script: cat /build/IN/buildami_repo/gitRepo/exec/output.txt

  - name: v634_update
    type: runSh
    dependencyMode: strict
    triggerMode: parallel
    steps:
      - IN: buildami_repo
        switch: off
      - IN: prod_release
        switch: off
      - IN: baseami_params
        switch: off
      - IN: ami_bits_access
        switch: off
      - IN: execTemplates_repo_file_tag
      - IN: node_repo_file_tag
      - IN: cexec_repo_file_tag
      - IN: reqExec_repo_tag
      - IN: reqProc_repo_tag
      - IN: c7repLib_x8664_tag
      - IN: u14repLib_x8664_tag
      - IN: u16repLib_x8664_tag
      - IN: u16repLib_aarch64_tag
      - TASK:
          script:
            - pushd $(shipctl get_resource_state "buildami_repo")
            - cd exec
            - ./execPackUpdate.sh v634_update prod_release ami-f156f78c v634 ami_bits_access
            - popd
    on_failure:
      - script: cat /build/IN/buildami_repo/gitRepo/exec/output.txt
